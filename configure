#!/bin/sh
## borrowed from https://github.com/sodium-friends/sodium-native/blob/master/configure
PREFIX="${PREFIX:-$PWD}"
KONAN="${KONAN:-$HOME/.konan}"
ARCH=${x86_64}
GCC=${GCC:-gcc}

cd libsodium

! [ -f autogen.sh ] && echo 'You need to run "npm run fetch-libsodium" first' && exit 1
./autogen.sh

if [ -z "$SYSROOT" ]; then
  case $(uname -a) in
    **Linux*x86_64**)
      ARCH=x86_64
      GCC=gcc
      ;;

    **Darwin*x86_64**)
      ARCH=x86_64
      GCC=clang
      ;;
  esac

  export CC=$(find $(find $(find $KONAN/dependencies -name *${ARCH/-/_/}* -type d) -name bin -type d) -name *$GCC | head -n1)
fi

echo $CC
./configure --prefix=$PREFIX "$@"
make install
